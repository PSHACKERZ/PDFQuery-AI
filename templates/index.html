<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDFQuery AI</title>
<link rel="icon" type="image/svg+xml" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%233b82f6"/><stop offset="100%" style="stop-color:%237c3aed"/></linearGradient></defs><circle cx="16" cy="16" r="15" fill="url(%23grad)"/><text x="16" y="14" fill="white" font-family="Arial, sans-serif" font-weight="bold" font-size="8" text-anchor="middle">PDF</text><path d="M16 15 L8 22 L24 22 Z" fill="white"/><circle cx="12" cy="19" r="1.2" fill="white"/><circle cx="16" cy="19" r="1.2" fill="white"/><circle cx="20" cy="19" r="1.2" fill="white"/></svg>'>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
.bg-gradient-text {
        background: linear-gradient(to right, #2563eb, #7c3aed);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .bg-gradient-button {
        background: linear-gradient(to right, #3b82f6, #7c3aed);
    }

    .bg-gradient-button:hover {
        background: linear-gradient(to right, #2563eb, #6d28d9);
    }

    .bg-gradient-avatar {
        background: linear-gradient(to bottom right, #3b82f6, #7c3aed);
    }

    .chat-container {
        height: 600px;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-slideIn {
        animation: slideIn 0.3s ease-out forwards;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-4px); }
    }

    .typing-dot {
        animation: bounce 1s infinite;
    }

    .ai-message-content ul {
        margin: 1rem 0;
        list-style: none;
    }
    
    .ai-message-content li {
        position: relative;
        padding-left: 1.5rem;
        margin-bottom: 0.5rem;
    }
    
    .ai-message-content li:before {
        content: "â€¢";
        position: absolute;
        left: 0.25rem;
        color: #6B7280;
        display: inline-block;
    }
    
    .ai-message-content code {
        color: #4B5563;
        background-color: #F3F4F6;
        padding: 0.125rem 0.375rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
        font-family: ui-monospace, monospace;
    }
</style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-6">
<div class="max-w-4xl mx-auto">
<!-- Header -->
<div class="text-center mb-8">
<div class="flex items-center justify-center gap-3">
<div class="w-12 h-12">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
  <!-- Background -->
  <defs>
    <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6" />
      <stop offset="100%" style="stop-color:#7c3aed" />
    </linearGradient>
  </defs>
  
  <!-- Main circle -->
  <circle cx="16" cy="16" r="15" fill="url(#grad)" />
  
  <!-- PDF text -->
  <text x="16" y="14" fill="white" font-family="Arial, sans-serif" font-weight="bold" font-size="8" text-anchor="middle">PDF</text>
  
  <!-- AI chat bubble -->
  <path d="M16 15 L8 22 L24 22 Z" fill="white" />
  
  <!-- AI dots -->
  <circle cx="12" cy="19" r="1.2" fill="white" />
  <circle cx="16" cy="19" r="1.2" fill="white" />
  <circle cx="20" cy="19" r="1.2" fill="white" />
</svg>
</div>
<h1 class="text-4xl font-bold bg-gradient-text">PDFQuery AI</h1>
</div>
<p class="text-gray-600 mt-2">Your intelligent PDF conversation companion</p>
</div>
<!-- PDF Upload -->
    <div class="text-center mb-8">
        <form id="pdf-upload-form" class="inline-block">
            <input type="file" name="file" accept=".pdf" class="hidden" id="pdf-input">
            <label for="pdf-input" class="inline-flex items-center px-6 py-3 rounded-xl bg-gradient-button text-white cursor-pointer hover:shadow-xl transition-all shadow-lg">
                <i class="fas fa-upload mr-2"></i>
                Upload PDF
            </label>
            <div class="text-xs text-gray-500 mt-2">Maximum file size: 16MB</div>
        </form>
        <div id="pdf-status" class="mt-2 text-sm font-medium"></div>
    </div>

    <!-- Chat Interface -->
    <div class="bg-white rounded-2xl shadow-xl p-6">
        <!-- Messages Container -->
        <div class="chat-container overflow-y-auto mb-6 pr-4" id="chat-messages">
            <div class="flex justify-start mb-6 animate-slideIn">
                <div class="flex items-start w-full">
                    <div class="h-8 w-8 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                            <defs>
                                <linearGradient id="grad-avatar" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#3b82f6" />
                                    <stop offset="100%" style="stop-color:#7c3aed" />
                                </linearGradient>
                            </defs>
                            <circle cx="16" cy="16" r="15" fill="url(#grad-avatar)" />
                            <text x="16" y="14" fill="white" font-family="Arial, sans-serif" font-weight="bold" font-size="8" text-anchor="middle">PDF</text>
                            <path d="M16 15 L8 22 L24 22 Z" fill="white" />
                            <circle cx="12" cy="19" r="1.2" fill="white" />
                            <circle cx="16" cy="19" r="1.2" fill="white" />
                            <circle cx="20" cy="19" r="1.2" fill="white" />
                        </svg>
                    </div>
                    <div class="max-w-[80%] rounded-2xl px-4 py-3 bg-white shadow-md flex-grow">
                        <div class="text-sm font-medium mb-1">PDFQuery AI</div>
                        <div class="text-sm text-gray-700">
                            Welcome to PDFQuery AI! Upload a PDF and I'll help you analyze and understand its content.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Typing Indicator -->
        <div id="typing-indicator" class="hidden flex items-center space-x-2 text-gray-500 text-sm ml-11 mb-4">
            <div class="flex space-x-1">
                <div class="w-2 h-2 rounded-full bg-gray-400 typing-dot"></div>
                <div class="w-2 h-2 rounded-full bg-gray-400 typing-dot" style="animation-delay: 0.2s"></div>
                <div class="w-2 h-2 rounded-full bg-gray-400 typing-dot" style="animation-delay: 0.4s"></div>
            </div>
            <span>AI is thinking...</span>
        </div>

        <!-- Input Form -->
        <div class="mb-4">
            <div class="text-sm text-gray-600 mb-2">Suggested prompts:</div>
            <div class="flex flex-wrap gap-2">
                <button class="prompt-suggestion px-3 py-1.5 text-sm bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 text-gray-700 rounded-lg border border-gray-200 transition-all">
                    Write a detailed summary
                </button>
                <button class="prompt-suggestion px-3 py-1.5 text-sm bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 text-gray-700 rounded-lg border border-gray-200 transition-all">
                    Extract key points
                </button>
                <button class="prompt-suggestion px-3 py-1.5 text-sm bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 text-gray-700 rounded-lg border border-gray-200 transition-all">
                    List main topics
                </button>
                <button class="prompt-suggestion px-3 py-1.5 text-sm bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 text-gray-700 rounded-lg border border-gray-200 transition-all">
                    Explain technical terms
                </button>
                <button class="prompt-suggestion px-3 py-1.5 text-sm bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 text-gray-700 rounded-lg border border-gray-200 transition-all">
                    Find conclusions
                </button>
            </div>
        </div>
        <form id="chat-form" class="flex items-center bg-gray-50 rounded-xl p-2">
            <input type="text" 
                id="chat-input" 
                placeholder="Ask about the PDF content..."
                class="flex-1 px-4 py-3 bg-transparent focus:outline-none text-gray-700 placeholder-gray-500"
                autocomplete="off"
            >
            <button type="submit" 
                class="ml-2 px-6 py-3 bg-gradient-button text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all flex items-center"
            >
                <span>Send</span>
                <i class="fas fa-paper-plane ml-2"></i>
            </button>
        </form>
    </div>
</div>

<!-- Contact Link -->
<div class="mt-8 text-center mb-4">
    <a
        href="https://t.me/PS_Hacker"
        target="_blank"
        rel="noopener noreferrer"
        class="
            inline-block
            text-xs
            text-blue-700
            px-2 py-1
            bg-gray-50 
            rounded-md
            transition-colors 
            duration-300
            hover:text-red-700
            hover:bg-gray-200
            focus:outline-none
            focus:ring-2
            focus:ring-offset-2
            focus:ring-blue-700
        "
        title="Contact P.S. Hackerz via Telegram"
        aria-label="Contact P.S. Hackerz via Telegram"
    >
        Made By @ P.S. Hackerz (Contact us)
    </a>
</div>

<script>
    let pdfUploaded = false;

    function appendMessage(message, isUser = false) {
        const messagesDiv = document.getElementById('chat-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'} mb-6 animate-slideIn w-full`;
        
        const formattedMessage = !isUser ? formatAIMessage(message) : message;
        
        if (isUser) {
            messageDiv.innerHTML = `
                <div class="flex items-start">
                    <div class="max-w-[80%] rounded-2xl px-4 py-3 bg-gradient-button text-white">
                        <div class="text-sm font-medium mb-1">You</div>
                        <div class="text-sm">${message}</div>
                    </div>
                    <div class="h-8 w-8 rounded-full bg-gradient-button flex items-center justify-center ml-3">
                        <i class="fas fa-user text-white text-sm"></i>
                    </div>
                </div>
            `;
        } else {
            messageDiv.innerHTML = `
                <div class="flex items-start w-full">
                    <div class="h-8 w-8 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                            <defs>
                                <linearGradient id="grad-avatar-${Date.now()}" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#3b82f6" />
                                    <stop offset="100%" style="stop-color:#7c3aed" />
                                </linearGradient>
                            </defs>
                            <circle cx="16" cy="16" r="15" fill="url(#grad-avatar-${Date.now()})" />
                            <text x="16" y="14" fill="white" font-family="Arial, sans-serif" font-weight="bold" font-size="8" text-anchor="middle">PDF</text>
                            <path d="M16 15 L8 22 L24 22 Z" fill="white" />
                            <circle cx="12" cy="19" r="1.2" fill="white" />
                            <circle cx="16" cy="19" r="1.2" fill="white" />
                            <circle cx="20" cy="19" r="1.2" fill="white" />
                        </svg>
                    </div>
                    <div class="max-w-[80%] rounded-2xl px-6 py-4 bg-white shadow-md flex-grow">
                        <div class="text-sm font-medium mb-2 text-gray-800">PDFQuery AI</div>
                        <div class="ai-message-content">${formattedMessage}</div>
                    </div>
                </div>
            `;
        }
        
        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function formatAIMessage(message) {
        // Create a wrapper div for better structure
        const wrapper = document.createElement('div');
        wrapper.className = 'ai-response space-y-4';
        
        const lines = message.split('\n').filter(line => line.trim());
        let currentList = null;
        
        lines.forEach(line => {
            // Headers
            if (line.startsWith('# ')) {
                if (currentList) {
                    wrapper.appendChild(currentList);
                    currentList = null;
                }
                const header = document.createElement('h3');
                header.className = 'text-lg font-bold text-gray-800 mt-4 mb-2';
                header.textContent = line.substring(2).trim();
                wrapper.appendChild(header);
            }
            else if (line.startsWith('## ')) {
                if (currentList) {
                    wrapper.appendChild(currentList);
                    currentList = null;
                }
                const header = document.createElement('h4');
                header.className = 'text-md font-semibold text-gray-700 mt-3 mb-2';
                header.textContent = line.substring(3).trim();
                wrapper.appendChild(header);
            }
            else if (line.startsWith('### ')) {
                if (currentList) {
                    wrapper.appendChild(currentList);
                    currentList = null;
                }
                const header = document.createElement('h5');
                header.className = 'text-sm font-semibold text-gray-600 mt-2 mb-1';
                header.textContent = line.substring(4).trim();
                wrapper.appendChild(header);
            }
            // Lists
            else if (line.startsWith('* ')) {
                if (!currentList) {
                    currentList = document.createElement('ul');
                    currentList.className = 'list-disc space-y-2 ml-6 text-gray-600';
                }
                const listItem = document.createElement('li');
                listItem.className = 'text-sm relative';
                let itemText = line.substring(2).trim();
                
                // Remove any existing bullet points from the text
                itemText = itemText.replace(/^[â€¢\-]\s*/, '');
                
                // Format inline elements within list items
                itemText = itemText
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold text-gray-700">$1</strong>')
                    .replace(/_(.*?)_/g, '<em class="italic">$1</em>')
                    .replace(/`(.*?)`/g, '<code class="bg-gray-100 px-1 py-0.5 rounded text-sm font-mono">$1</code>');
                
                listItem.innerHTML = itemText;
                currentList.appendChild(listItem);
            }
            // Regular paragraphs
            else {
                if (currentList) {
                    wrapper.appendChild(currentList);
                    currentList = null;
                }
                const para = document.createElement('p');
                para.className = 'text-sm text-gray-600 mb-2';
                let text = line;
                
                // Format inline elements
                text = text
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold text-gray-700">$1</strong>')
                    .replace(/_(.*?)_/g, '<em class="italic">$1</em>')
                    .replace(/`(.*?)`/g, '<code class="bg-gray-100 px-1 py-0.5 rounded text-sm font-mono">$1</code>');
                
                para.innerHTML = text;
                wrapper.appendChild(para);
            }
        });
        
        // Append any remaining list
        if (currentList) {
            wrapper.appendChild(currentList);
        }
        
        return wrapper.innerHTML;
    }

    function updateStatus(message, isError = false) {
        const statusDiv = document.getElementById('pdf-status');
        statusDiv.className = `mt-3 text-sm font-medium ${isError ? 'text-red-500' : 'text-green-500'}`;
        statusDiv.innerHTML = `
            <i class="fas fa-${isError ? 'exclamation-circle' : 'check-circle'} mr-1"></i>
            ${message}
        `;
    }

    async function sendMessage() {
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        if (!message) return;

        if (!pdfUploaded) {
            appendMessage('Please upload a PDF first before asking questions. Click the "Upload PDF" button above.', false);
            return;
        }

        appendMessage(message, true);
        input.value = '';

        const typingIndicator = document.getElementById('typing-indicator');
        typingIndicator.classList.remove('hidden');

        try {
            const response = await fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message }),
            });

            const data = await response.json();
            typingIndicator.classList.add('hidden');
            
            if (!response.ok) {
                throw new Error(data.error || 'An error occurred');
            }
            
            if (data.error) {
                appendMessage(data.error, false);
            } else {
                appendMessage(data.response);
            }
        } catch (error) {
            typingIndicator.classList.add('hidden');
            appendMessage(`Error: ${error.message || 'Could not process your request. Please try again.'}`, false);
            console.error('Chat error:', error);
        }
    }

    document.getElementById('chat-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    document.getElementById('pdf-input').addEventListener('change', async function(e) {
        const file = e.target.files[0];
        if (!file) return;

        // Check file size (16MB = 16 * 1024 * 1024 bytes)
        if (file.size > 16 * 1024 * 1024) {
            updateStatus('File is too large. Maximum size is 16MB', true);
            this.value = ''; // Clear the file input
            pdfUploaded = false;
            return;
        }

        // Check file type
        if (!file.type.includes('pdf')) {
            updateStatus('Only PDF files are allowed', true);
            this.value = '';
            pdfUploaded = false;
            return;
        }

        updateStatus('Uploading PDF...', false);
        const formData = new FormData();
        formData.append('file', file);

        try {
            const response = await fetch('/upload-pdf', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || 'Upload failed');
            }
            
            if (data.error) {
                updateStatus(data.error, true);
                pdfUploaded = false;
            } else {
                updateStatus('PDF uploaded successfully! âœ¨', false);
                pdfUploaded = true;
                appendMessage(data.message, false);
            }
        } catch (error) {
            updateStatus(error.message || 'Error uploading PDF', true);
            pdfUploaded = false;
            console.error('Upload error:', error);
        }
        finally {
            if (!pdfUploaded) {
                this.value = ''; // Clear file input on error
            }
        }
    });

    // Update form submission
    document.getElementById('chat-form').addEventListener('submit', function(e) {
        e.preventDefault();
        sendMessage();
    });

    // Add event listeners for prompt suggestions
    document.querySelectorAll('.prompt-suggestion').forEach(button => {
        button.addEventListener('click', (e) => {
            e.preventDefault();
            const chatInput = document.getElementById('chat-input');
            chatInput.value = button.textContent.trim();
            chatInput.focus();
        });
    });
</script>
</body>
</html>